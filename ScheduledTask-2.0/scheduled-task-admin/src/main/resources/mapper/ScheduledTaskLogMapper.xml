<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xiaohe.mapper.ScheduledTaskLogMapper">


    <resultMap id="ScheduledTaskLog" type="com.xiaohe.core.model.ScheduledTaskLog" >
        <result column="id" property="id" />

        <result column="job_group" property="jobGroup" />
        <result column="job_id" property="jobId" />

        <result column="executor_address" property="executorAddress" />
        <result column="executor_handler" property="executorHandler" />
        <result column="executor_param" property="executorParam" />
        <result column="executor_sharding_param" property="executorShardingParam" />
        <result column="executor_fail_retry_count" property="executorFailRetryCount" />

        <result column="trigger_time" property="triggerTime" />
        <result column="trigger_code" property="triggerCode" />
        <result column="trigger_msg" property="triggerMsg" />

        <result column="handle_time" property="handleTime" />
        <result column="handle_code" property="handleCode" />
        <result column="handle_msg" property="handleMsg" />

        <result column="alarm_status" property="alarmStatus" />
    </resultMap>

    <sql id="Base_Column_List">
        t.id,
		t.job_group,
		t.job_id,
		t.executor_address,
		t.executor_handler,
		t.executor_param,
		t.executor_sharding_param,
		t.executor_fail_retry_count,
		t.trigger_time,
		t.trigger_code,
		t.trigger_msg,
		t.handle_time,
		t.handle_code,
		t.handle_msg,
		t.alarm_status
    </sql>

<!--    useGeneratedKeys : 使用自动生成的id，并注入到对象中-->
    <insert id="save" parameterType="com.xiaohe.core.model.ScheduledTaskLog" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO scheduled_task_log (`job_group`,
                                        `job_id`,
                                        `trigger_time`,
                                        `trigger_code`,
                                        `handle_code`)
        VALUES (#{jobGroup},
                #{jobId},
                #{triggerTime},
                #{triggerCode},
                #{handlerCode});

    </insert>
    <update id="updateTriggerInfo">
        UPDATE scheduled_task_log
        SET
            `trigger_time` = #{triggerTime},
            `trigger_code` = #{triggerCode},
            `trigger_code` = #{triggerMsg},
            `executor_address` = #{executorAddress},
            `executor_handler` = #{executorHandler},
            `executor_param` = #{executorParam},
            `executor_sharding_param` = #{executorShardingParam},
            `executor_fail_retry_count` = #{executorFailRetryCount}
        WHERE `id` = #{id}
    </update>
    <select id="load" resultType="com.xiaohe.core.model.ScheduledTaskLog" parameterType="long">
        SELECT <include refid="Base_Column_List"></include>
            FROM scheduled_task_log AS t
        WHERE `id` = #{id}
    </select>


    <update id="updateHandleInfo">
        update scheduled_task_log
        set `handle_time` = #{handleTime},
            `handle_code` = #{handleCode},
            `handle_msg`  = #{handleMsg}
        where `id` = #{id}

    </update>
</mapper>